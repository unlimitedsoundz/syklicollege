module.exports=[77782,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(46504)},8649,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},70326,a=>{"use strict";var b=a.i(77782),c=a.i(2669),d=a.i(46235);async function e(a,b){let d=await h(),e=(a||"").trim().toUpperCase(),{data:f,error:g}=await d.from("profiles").select("email, date_of_birth").eq("student_id",e).maybeSingle();if(g)return console.error("[LOGIN] Profile lookup error:",g),{error:"Authentication service error. Please try again."};if(!f)return console.log(`[LOGIN] Student ID not found: ${e}`),{error:"Invalid Student ID or Date of Birth. Please check your credentials."};let i=f.date_of_birth?String(f.date_of_birth):null;if(i!==b)return console.log(`[LOGIN] DOB mismatch for ${e}: DB=${i}, Input=${b}`),{error:"Invalid Student ID or Date of Birth. Please check your credentials."};let{data:j,error:k}=await d.auth.admin.generateLink({type:"magiclink",email:f.email,options:{redirectTo:`${process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000"}/portal/dashboard`}});if(k||!j?.properties?.hashed_token)return console.error("[LOGIN] Admin link generation error:",k),{error:"Authentication failed. Please contact support."};let l=await (0,c.createClient)(),{error:m}=await l.auth.verifyOtp({token_hash:j.properties.hashed_token,type:"magiclink"});return m?(console.error("[LOGIN] Verify OTP error:",m),{error:"Session verification failed. Please try again."}):{success:!0}}async function f(a,b){let d=await (0,c.createClient)(),{data:e,error:f}=await d.from("profiles").select("email, role").eq("email",a.toLowerCase()).eq("date_of_birth",b).eq("role","ADMIN").single();if(f||!e)return{error:"Invalid Email or Date of Birth, or you do not have administrative access."};let g=await h(),{data:i,error:j}=await g.auth.admin.generateLink({type:"magiclink",email:e.email,options:{redirectTo:`${process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000"}/portal/dashboard`}});if(j||!i?.properties?.hashed_token)return console.error("Admin link generation error:",j),{error:"Authentication failed. Please contact support."};let{error:k}=await (await (0,c.createClient)()).auth.verifyOtp({token_hash:i.properties.hashed_token,type:"magiclink"});return k?(console.error("Verify OTP error:",k),{error:"Session verification failed. Please try again."}):{success:!0}}async function g(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("profiles").select("student_id").eq("email",a).single();return e||!d?{error:"Could not retrieve Student ID. Please check your email for the login link."}:{studentId:d.student_id}}async function h(){let{createClient:b}=await a.A(58325);return b("https://mrqzlmkdhzwvbpljikjz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}async function i(a){let b=await h(),{data:d,error:e}=await b.auth.admin.createUser({email:a.email,email_confirm:!0,user_metadata:{first_name:a.firstName,last_name:a.lastName,country_of_residence:a.country,date_of_birth:a.dateOfBirth,role:"APPLICANT"}});if(e)return console.error("Admin user creation error:",e),{error:e.message};let{data:f,error:g}=await b.auth.admin.generateLink({type:"magiclink",email:a.email,options:{redirectTo:`${process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000"}/portal/dashboard`}});if(g||!f?.properties?.hashed_token)return{success:!0,message:"Account created! Please sign in using your Student ID and Date of Birth."};let{error:i}=await (await (0,c.createClient)()).auth.verifyOtp({token_hash:f.properties.hashed_token,type:"magiclink"});if(i)return{success:!0,message:"Account created! Please sign in manually using your Student ID."};let{data:j}=await (await (0,c.createClient)()).from("profiles").select("student_id").eq("email",a.email).single();return{success:!0,studentId:j?.student_id}}async function j(a){let b=await h(),{data:c,error:d}=await b.auth.admin.createUser({email:a.email,email_confirm:!0,user_metadata:{first_name:a.firstName,last_name:a.lastName,date_of_birth:a.dateOfBirth,role:"ADMIN"}});return d?(console.error("Admin user creation error:",d),{error:d.message}):{success:!0,message:"Admin account created successfully! You can now sign in."}}async function k(a){let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)throw Error("Unauthorized");let{error:f}=await b.from("profiles").update({avatar_url:a,updated_at:new Date().toISOString()}).eq("id",e.id);if(f)throw console.error("Error updating avatar URL:",f),Error("Failed to update profile picture");return(0,d.revalidatePath)("/portal/account"),{success:!0}}(0,a.i(8649).ensureServerEntryExports)([e,f,g,i,j,k]),(0,b.registerServerReference)(e,"609d19df5427d9da6d223e310fc533c53a17975754",null),(0,b.registerServerReference)(f,"605a2100c58d9c4218ac9b95896936862233267950",null),(0,b.registerServerReference)(g,"406974b5909698da5e324d6caf7def8a23e03a23d0",null),(0,b.registerServerReference)(i,"40a85d9a0ad942672a9a4b9b0baacf44a8f1c08ec9",null),(0,b.registerServerReference)(j,"407cc7c2c3a38d772dadc291efbee912eacb221952",null),(0,b.registerServerReference)(k,"40806c47840d6e54d238522fad8a664287b2c7b38d",null),a.s(["adminLoginWithEmail",()=>f,"loginWithStudentId",()=>e,"registerAdmin",()=>j,"registerApplicant",()=>i,"updateAvatarUrl",()=>k])},80065,a=>{"use strict";var b=a.i(70326);a.s([],31947),a.i(31947),a.s(["605a2100c58d9c4218ac9b95896936862233267950",()=>b.adminLoginWithEmail],80065)},58325,a=>{a.v(b=>Promise.all(["server/chunks/ssr/82946_@supabase_supabase-js_dist_index_mjs_ad90246a._.js"].map(b=>a.l(b))).then(()=>b(16266)))}];

//# sourceMappingURL=OneDrive_Documents_syklicollege_857b0440._.js.map