module.exports=[77782,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(46504)},8649,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},53565,a=>{"use strict";var b=a.i(96350);function c(){if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("Missing Supabase Service Role Key");return(0,b.createClient)("https://mrqzlmkdhzwvbpljikjz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}a.s(["createAdminClient",()=>c])},99811,a=>{"use strict";var b=a.i(77782),c=a.i(2669),d=a.i(53565),e=a.i(46235);async function f(b){try{let f=await (0,c.createClient)(),g=(0,d.createAdminClient)(),{data:{user:h}}=await f.auth.getUser();if(!h)return{success:!1,error:"Not authenticated"};let{data:i}=await f.from("students").select("id, enrollment_status").eq("user_id",h.id).single();if(!i)return{success:!1,error:"Student record not found"};if("ACTIVE"!==i.enrollment_status)return{success:!1,error:"Housing is only available to active students"};let{data:j}=await f.from("housing_applications").select("id, status").eq("student_id",i.id).eq("semester_id",b.semesterId).single();if(j&&"REJECTED"!==j.status)return{success:!1,error:"You already have an application for this semester"};let k=Math.floor(100*Math.random()),{data:l,error:m}=await g.from("housing_applications").insert({student_id:i.id,semester_id:b.semesterId,preferred_building_id:b.preferredBuildingId,move_in_date:b.moveInDate,move_out_date:b.moveOutDate,notes:b.notes,priority_score:k,status:"PENDING"}).select().single();if(m)return{success:!1,error:m.message};try{let{generateHousingInvoice:b}=await a.A(81827);await b(i.id,l.id,[{description:"Housing Deposit (Security & Keys)",type:"HOUSING_DEPOSIT",amount:500}])}catch(a){console.error("Failed to generate invoice:",a)}return(0,e.revalidatePath)("/portal/student/housing"),{success:!0,application:l}}catch(a){return{success:!1,error:a.message}}}async function g(a){let b=(0,d.createAdminClient)(),f=await (0,c.createClient)(),{data:{user:g}}=await f.auth.getUser();if(!g)throw Error("Not authenticated");let{data:h}=await f.from("profiles").select("role").eq("id",g.id).single();if(h?.role!=="ADMIN")throw Error("Unauthorized");let{data:i,error:j}=await b.from("housing_buildings").insert(a).select().single();if(j)throw j;return(0,e.revalidatePath)("/admin/housing"),{success:!0,building:i}}async function h(a){let b=(0,d.createAdminClient)(),f=await (0,c.createClient)(),{data:{user:g}}=await f.auth.getUser();if(!g)throw Error("Not authenticated");let{data:h}=await f.from("profiles").select("role").eq("id",g.id).single();if(h?.role!=="ADMIN")throw Error("Unauthorized");let{data:i,error:j}=await b.from("housing_rooms").insert({...a,amenities:a.amenities||[]}).select().single();if(j)throw j;return(0,e.revalidatePath)("/admin/housing"),{success:!0,room:i}}async function i(a,b){let f=await (0,c.createClient)(),g=(0,d.createAdminClient)(),{data:{user:h}}=await f.auth.getUser();if(!h)throw Error("Not authenticated");let{data:i}=await f.from("students").select("id").eq("user_id",h.id).single();if(!i)throw Error("Student record not found");let j=`TXN-${Date.now()}`,{data:k,error:l}=await g.from("housing_deposits").insert({application_id:a,student_id:i.id,amount:b,payment_status:"PAID",payment_method:"CARD",transaction_id:j,paid_at:new Date().toISOString()}).select().single();if(l)throw l;return await g.from("housing_applications").update({status:"APPROVED"}).eq("id",a),(0,e.revalidatePath)("/portal/student/housing"),{success:!0,deposit:k}}async function j(a,b){let f=await (0,c.createClient)(),g=(0,d.createAdminClient)(),{data:{user:h}}=await f.auth.getUser();if(!h)throw Error("Not authenticated");let{data:i}=await f.from("profiles").select("role").eq("id",h.id).single();if(i?.role!=="ADMIN"&&i?.role!=="REGISTRAR")throw Error("Unauthorized: Admin/Registrar access required");let{data:j}=await g.from("housing_applications").select("*, student:students(*)").eq("id",a).single();if(!j)throw Error("Application not found");let{data:k}=await g.from("housing_rooms").select("*").eq("id",b).single();if(!k||"AVAILABLE"!==k.status)throw Error("Room is not available");let{data:l,error:m}=await g.from("housing_assignments").insert({application_id:a,room_id:b,student_id:j.student_id,start_date:j.move_in_date,end_date:j.move_out_date,status:"ASSIGNED"}).select().single();if(m)throw m;return await g.from("housing_rooms").update({status:"OCCUPIED"}).eq("id",b),(0,e.revalidatePath)("/admin/housing"),(0,e.revalidatePath)("/portal/student/housing"),{success:!0,assignment:l}}async function k(a){let b=(0,d.createAdminClient)(),f=await (0,c.createClient)(),{data:{user:g}}=await f.auth.getUser();if(!g)throw Error("Not authenticated");let{data:h}=await f.from("profiles").select("role").eq("id",g.id).single();if(h?.role!=="ADMIN")throw Error("Unauthorized");let{data:i}=await b.from("housing_invoices").select("id").eq("application_id",a);if(i&&i.length>0){let a=i.map(a=>a.id);await b.from("housing_payments").delete().in("invoice_id",a),await b.from("housing_invoice_items").delete().in("invoice_id",a),await b.from("housing_invoices").delete().in("id",a)}await b.from("housing_deposits").delete().eq("application_id",a);let{data:j}=await b.from("housing_assignments").select("room_id").eq("application_id",a);if(j&&j.length>0){let c=j.map(a=>a.room_id);await b.from("housing_assignments").delete().eq("application_id",a),await b.from("housing_rooms").update({status:"AVAILABLE"}).in("id",c)}await b.from("housing_audit_logs").delete().eq("target_id",a);let{error:k}=await b.from("housing_applications").delete().eq("id",a);if(k)throw k;return(0,e.revalidatePath)("/admin/housing"),{success:!0}}async function l(a){let b=(0,d.createAdminClient)(),f=await (0,c.createClient)(),{data:{user:g}}=await f.auth.getUser();if(!g)throw Error("Not authenticated");let{data:h}=await f.from("profiles").select("role").eq("id",g.id).single();if(h?.role!=="ADMIN")throw Error("Unauthorized");let{data:i}=await b.from("housing_assignments").select("room_id").eq("id",a).single();if(!i)throw Error("Assignment not found");let{error:j}=await b.from("housing_assignments").delete().eq("id",a);if(j)throw j;return await b.from("housing_rooms").update({status:"AVAILABLE"}).eq("id",i.room_id),(0,e.revalidatePath)("/admin/housing"),{success:!0}}async function m(a){let b=(0,d.createAdminClient)(),f=await (0,c.createClient)(),{data:{user:g}}=await f.auth.getUser();if(!g)throw Error("Not authenticated");let{data:h}=await f.from("profiles").select("role").eq("id",g.id).single();if(h?.role!=="ADMIN")throw Error("Unauthorized");let{data:i}=await b.from("housing_assignments").select("id").eq("room_id",a).limit(1);if(i&&i.length>0)throw Error("Cannot delete room with active or past assignments. Delete assignments first.");let{error:j}=await b.from("housing_rooms").delete().eq("id",a);if(j)throw j;return(0,e.revalidatePath)("/admin/housing"),{success:!0}}async function n(a){let b=(0,d.createAdminClient)(),f=await (0,c.createClient)(),{data:{user:g}}=await f.auth.getUser();if(!g)throw Error("Not authenticated");let{data:h}=await f.from("profiles").select("role").eq("id",g.id).single();if(h?.role!=="ADMIN")throw Error("Unauthorized");let{data:i}=await b.from("housing_rooms").select("id").eq("building_id",a).limit(1);if(i&&i.length>0)throw Error("Cannot delete building with existing rooms. Delete rooms first.");let{error:j}=await b.from("housing_buildings").delete().eq("id",a);if(j)throw j;return(0,e.revalidatePath)("/admin/housing"),{success:!0}}async function o(a,b){let f=(0,d.createAdminClient)(),g=await (0,c.createClient)(),{data:{user:h}}=await g.auth.getUser();if(!h)throw Error("Not authenticated");let{data:i}=await g.from("profiles").select("role").eq("id",h.id).single();if(i?.role!=="ADMIN")throw Error("Unauthorized");let{error:j}=await f.from("housing_buildings").update(b).eq("id",a);if(j)throw j;return(0,e.revalidatePath)("/admin/housing"),{success:!0}}async function p(a,b){let f=(0,d.createAdminClient)(),g=await (0,c.createClient)(),{data:{user:h}}=await g.auth.getUser();if(!h)throw Error("Not authenticated");let{data:i}=await g.from("profiles").select("role").eq("id",h.id).single();if(i?.role!=="ADMIN")throw Error("Unauthorized");let{error:j}=await f.from("housing_rooms").update({...b,amenities:b.amenities||[]}).eq("id",a);if(j)throw j;return(0,e.revalidatePath)("/admin/housing"),{success:!0}}(0,a.i(8649).ensureServerEntryExports)([f,g,h,i,j,k,l,m,n,o,p]),(0,b.registerServerReference)(f,"406b56fb871d83a941800e4edfe64293a99a5ca43b",null),(0,b.registerServerReference)(g,"40fbfd8d3156d2d1d7590e75aab7cdc5ba5184aaf2",null),(0,b.registerServerReference)(h,"40cd65d5d20c8b9206666b81c4e413758d921d1953",null),(0,b.registerServerReference)(i,"601f93a41104b5c96bea76f5a74fbc228d3c662f12",null),(0,b.registerServerReference)(j,"60ce23176651b4b00bbdbbccb63b9c0f6cfcf29180",null),(0,b.registerServerReference)(k,"40499e544b1354c16ef9a565a39d86938ac84f5917",null),(0,b.registerServerReference)(l,"40698372ac8df9a0712f1734cb4a40e1b201b9d4d0",null),(0,b.registerServerReference)(m,"40f87ed01b784d9871b2eeba883aa4e9688e33793d",null),(0,b.registerServerReference)(n,"403ad30637d3edde8d4724442a842dc17443bd7d77",null),(0,b.registerServerReference)(o,"601c286942e492cf95ebcec9a34a751e7dd7ec06c3",null),(0,b.registerServerReference)(p,"601d2b37756c408f924b5a2c09e729de92fc80c241",null),a.s(["createBuilding",()=>g,"createRoom",()=>h,"deleteHousingApplication",()=>k,"deleteHousingAssignment",()=>l,"deleteHousingBuilding",()=>n,"deleteHousingRoom",()=>m,"submitHousingApplication",()=>f,"updateBuilding",()=>o,"updateRoom",()=>p])},70851,a=>{"use strict";var b=a.i(99811);a.s([],79452),a.i(79452),a.s(["403ad30637d3edde8d4724442a842dc17443bd7d77",()=>b.deleteHousingBuilding,"40499e544b1354c16ef9a565a39d86938ac84f5917",()=>b.deleteHousingApplication,"40698372ac8df9a0712f1734cb4a40e1b201b9d4d0",()=>b.deleteHousingAssignment,"40cd65d5d20c8b9206666b81c4e413758d921d1953",()=>b.createRoom,"40f87ed01b784d9871b2eeba883aa4e9688e33793d",()=>b.deleteHousingRoom,"40fbfd8d3156d2d1d7590e75aab7cdc5ba5184aaf2",()=>b.createBuilding,"601c286942e492cf95ebcec9a34a751e7dd7ec06c3",()=>b.updateBuilding,"601d2b37756c408f924b5a2c09e729de92fc80c241",()=>b.updateRoom],70851)},81827,a=>{a.v(b=>Promise.all(["server/chunks/ssr/OneDrive_Documents_syklicollege_src_app_portal_payment-actions_ts_8c67fe3c._.js"].map(b=>a.l(b))).then(()=>b(39071)))}];

//# sourceMappingURL=OneDrive_Documents_syklicollege_8b3470cb._.js.map